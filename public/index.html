<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>VAT Validation</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 40px; max-width: 900px; }
      textarea { width: 100%; height: 180px; padding: 10px; font-size: 14px; }
      button { padding: 10px 14px; font-size: 14px; cursor: pointer; margin-top: 10px; }
      pre { background: #f4f4f4; padding: 12px; border-radius: 8px; overflow: auto; }
      .hint { color: #444; font-size: 13px; }
    </style>
  </head>
  <body>
    <h2>VAT validation (VATcomply)</h2>

    <p class="hint">
      Vul VAT-nummers in <b>met</b> country prefix. Elke regel = één VAT.<br/>
      Voorbeelden: <code>NL002065538B01</code>, <code>EL094395030</code>, <code>DE123456789</code>, <code>XI123456789</code>
    </p>

    <textarea id="vats" placeholder="NL002065538B01&#10;EL094395030"></textarea>
    <br />
    <button id="btn">Validate</button>

<h3>Result</h3>
<div id="result"></div>


<script>
  const $ = (id) => document.getElementById(id);

  function parseLines(text) {
    return text
      .split(/\r?\n/)
      .map(l => l.trim())
      .filter(l => l.length > 0);
  }

  function renderTable(data) {
    if (!data.results || !data.results.length) {
      $("result").innerHTML = "<p>No results</p>";
      return;
    }

    const columns = [
      "input",
      "source",
      "valid",
      "vat_number",
      "name",
      "address",
      "country_code",
      "error",
      "status"
    ];

    let html = "<table border='1' cellpadding='6' cellspacing='0' style='border-collapse:collapse; font-size:13px;'>";
    html += "<thead><tr>";

    columns.forEach(col => {
      html += `<th>${col}</th>`;
    });

    html += "</tr></thead><tbody>";

    data.results.forEach(row => {
      html += "<tr>";
      columns.forEach(col => {
        let value = row[col] ?? "";
        if (typeof value === "boolean") value = value ? "true" : "false";
        html += `<td>${value}</td>`;
      });
      html += "</tr>";
    });

    html += "</tbody></table>";

    $("result").innerHTML = html;
  }

  async function validateBatch() {
    const vat_numbers = parseLines($("vats").value);

    const res = await fetch("/api/validate-batch", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ vat_numbers })
    });

    const data = await res.json().catch(() => ({}));
    renderTable(data);
  }

  $("btn").addEventListener("click", validateBatch);
</script>
  </body>
</html>
